{% extends "base.html" %}
{% block content %}

<h2 class="mb-3">My Profile</h2>

<div class="card shadow-sm mb-4">
    <div class="card-body">

        <!-- =========================
             PROFILE PICTURE
        ========================== -->
        <div class="text-center mb-3">

            {% if user.profile_image %}
                <img src="{{ url_for('static',
                    filename='uploads/profile_pics/' ~ user.profile_image) }}"
                     class="rounded-circle mb-2"
                     width="130"
                     height="130">
            {% else %}
                <img src="{{ url_for('static',
                    filename='images/default_profile.png') }}"
                     class="rounded-circle mb-2"
                     width="130"
                     height="130">
            {% endif %}

            <form method="POST"
                  action="{{ url_for('profile.upload_photo') }}"
                  enctype="multipart/form-data"
                  class="mt-2">

                <input type="file"
                       name="photo"
                       class="form-control form-control-sm mb-2"
                       accept="image/*"
                       required>

                <button class="btn btn-sm btn-outline-primary">
                    Upload Photo
                </button>
            </form>
        </div>

        <!-- =========================
             USER INFO
        ========================== -->
        <p><strong>Name:</strong> {{ user.name }}</p>
        <p><strong>Email:</strong> {{ user.email }}</p>
        <p><strong>Role:</strong> {{ user.user_type|capitalize }}</p>

        <a href="{{ url_for('profile.edit_profile') }}"
           class="btn btn-warning btn-sm">
            Edit Profile
        </a>

        <a href="{{ url_for('profile.change_password') }}"
           class="btn btn-secondary btn-sm">
            Change Password
        </a>

        <hr>

        <!-- =========================
             PROFILE COMPLETION (FEATURE D)
        ========================== -->
        <h5>Profile Completion</h5>
        <div class="progress mb-2">
            <div class="progress-bar bg-success"
                 style="width: {{ profile_score }}%">
                {{ profile_score }}%
            </div>
        </div>
        <p class="text-muted small">
            Profile score improves job recommendations and match accuracy.
        </p>

        <hr>

        <!-- =========================
             JOB SEEKER ACTIONS
        ========================== -->
        {% if user.user_type in ["job_seeker", "employee"] %}
            <a class="btn btn-primary btn-sm"
               href="{{ url_for('applications.my_applications') }}">
                View My Applications
            </a>
        {% endif %}

        <!-- =========================
             BUSINESS ACTIONS
        ========================== -->
        {% if user.user_type == "business" %}
            <a href="{{ url_for('company.view_my_company') }}"
               class="btn btn-info btn-sm">
                View Company
            </a>

            <a href="{{ url_for('jobs.my_jobs') }}"
               class="btn btn-success btn-sm">
                View Posted Jobs
            </a>
        {% endif %}

    </div>
</div>

{% endblock %}
